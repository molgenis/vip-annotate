Bootstrap: localimage
From: ubuntu-24.04.sif
Stage: build-ubuntu

Bootstrap: localimage
From: streamvbyte-2.0.0.sif
Stage: build-streamvbyte

Bootstrap: localimage
From: zstd-1.5.7.sif
Stage: build-zstd

Bootstrap: localimage
From: busybox-1.37.0-musl.sif
Stage: final

%files
    ./vip-annotate /opt/vip-annotate/bin/vip-annotate

%files from build-ubuntu
    /lib/x86_64-linux-gnu/libc.so.6
    /lib/x86_64-linux-gnu/libz.so.1
    /lib64/ld-linux-x86-64.so.2

%files from build-streamvbyte
    /streamvbyte-2.0.0/libstreamvbyte.so.0.0.1 /opt/vip-annotate/lib/libstreamvbyte.so.0.0.1

%files from build-zstd
    /zstd-1.5.7/lib/libzstd.so.1.5.7 /opt/vip-annotate/lib/libzstd.so.1.5.7

%environment
    export PATH=/opt/vip-annotate/bin/vip-annotate:${PATH}
    export STREAMVBYTE_LIB_PATH="/opt/vip-annotate/lib/libstreamvbyte.so.0.0.1"
    export ZSTD_LIB_PATH="/opt/vip-annotate/lib/libzstd.so.1.5.7"

%runscript
    exec vip-annotate "$@"